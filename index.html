<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jogo Clicker Cooperativo</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      user-select: none;
    }

    .game-container {
      width: 90%;
      max-width: 800px;
      margin: 20px auto;
      text-align: center;
    }

    .progress-container {
      width: 100%;
      height: 30px;
      background-color: #e0e0e0;
      border-radius: 15px;
      margin: 20px 0;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background-color: #4CAF50;
      width: 0%;
      transition: width 0.2s;
      border-radius: 15px;
    }

    .stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .stat-box {
      background-color: #fff;
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      flex: 1;
      min-width: 100px;
      margin: 5px;
    }

    .click-area {
      width: 100%;
      height: 200px;
      background-color: #fff;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.1s;
      margin-bottom: 20px;
    }

    .click-area:active {
      transform: scale(0.98);
      background-color: #f8f8f8;
    }

    h1 {
      color: #333;
    }

    .level-up {
      animation: pulse 1s;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .game-sections {
      display: flex;
      gap: 20px;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .section {
      flex: 1;
      min-width: 300px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 15px;
      margin-bottom: 20px;
    }

    .upgrade-item, .achievement-item {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.2s;
    }

    .upgrade-item:hover {
      background-color: #f0f0f0;
    }

    .upgrade-item.disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .buy-button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .buy-button:hover {
      background-color: #45a049;
    }

    .buy-button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    .achievement-item.unlocked {
      background-color: #e7f7e7;
      border-left: 4px solid #4CAF50;
    }

    .achievement-item.locked {
      background-color: #f0f0f0;
      border-left: 4px solid #cccccc;
      color: #777;
    }

    .upgrade-info, .achievement-info {
      text-align: left;
    }
    
    .upgrade-level {
      font-size: 0.8em;
      color: #666;
    }
    
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #4CAF50;
      color: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .notification.show {
      opacity: 1;
    }
    
    /* Estilos para elementos cooperativos */
    .player-setup {
      background-color: #fff;
      border-radius: 10px;
      padding: 15px;
      margin: 20px 0;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .player-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
    }
    
    .player-tag {
      background-color: #e0e0e0;
      padding: 5px 10px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .player-tag[data-active="true"] {
      background-color: #d4edda;
      border: 1px solid #4CAF50;
    }
    
    .player-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 10px;
    }
    
    .player-input {
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 200px;
    }
    
    .team-goal-section {
      background-color: #e7f0ff;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      text-align: center;
    }
    
    .contribution-bar {
      height: 8px;
      border-radius: 4px;
      margin: 2px 0;
      background-color: #e0e0e0;
    }
    
    .contribution-fill {
      height: 100%;
      border-radius: 4px;
      width: 0%;
      transition: width 0.3s;
    }
    
    .bonus-message {
      padding: 8px;
      background-color: #fffae6;
      border-left: 3px solid #ffd700;
      text-align: left;
      margin: 10px 0;
      font-size: 0.9em;
    }
    
    .player-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-color: #007bff;
      display: inline-block;
      margin-right: 5px;
      text-align: center;
      color: white;
      font-weight: bold;
      line-height: 24px;
      font-size: 12px;
    }
    
    .player-contribution {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 5px 0;
    }
    
    .player-role {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 0.8em;
      margin-left: 5px;
      background-color: #e6e6e6;
    }
    
    .role-clicker {
      background-color: #d1e7dd;
      border: 1px solid #4CAF50;
    }
    
    .role-upgrader {
      background-color: #cfe2ff;
      border: 1px solid #0d6efd;
    }
    
    .role-supporter {
      background-color: #f8d7da;
      border: 1px solid #dc3545;
    }
    
    .chat-container {
      max-height: 150px;
      overflow-y: auto;
      background-color: #fff;
      border-radius: 10px;
      padding: 10px;
      margin-top: 15px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .chat-message {
      margin: 5px 0;
      padding: 5px;
      border-radius: 5px;
      font-size: 0.9em;
    }
    
    .chat-system {
      background-color: #f8f9fa;
      color: #666;
      font-style: italic;
    }
    
    .chat-player {
      background-color: #f1f8ff;
      border-left: 3px solid #0d6efd;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>Clicker Cooperativo</h1>
    
    <div class="player-setup">
      <h2>Jogadores</h2>
      <div class="player-list" id="player-list">
        <!-- Lista de jogadores será adicionada aqui -->
      </div>
      <div class="player-controls">
        <input type="text" class="player-input" id="player-name" placeholder="Seu nome">
        <select id="player-role" class="player-input">
          <option value="clicker">Clicker (Cliques +20%)</option>
          <option value="upgrader">Upgrader (Upgrades -15%)</option>
          <option value="supporter">Supporter (Bônus para equipe)</option>
        </select>
        <button class="buy-button" id="add-player">Adicionar Jogador</button>
        <button class="buy-button" id="switch-player">Alternar Jogador</button>
      </div>
    </div>
    
    <div class="team-goal-section">
      <h2>Objetivo da Equipe: Nível <span id="team-goal">5</span></h2>
      <div>Progresso: <span id="team-progress">1</span>/<span id="team-goal-display">5</span></div>
      <div class="progress-container">
        <div class="progress-bar" id="team-progress-bar"></div>
      </div>
      <div class="bonus-message" id="team-bonus-message">
        Trabalhem juntos para ganhar bônus para toda a equipe!
      </div>
    </div>
    
    <div class="stats">
      <div class="stat-box">
        <h3>Jogador</h3>
        <div id="active-player">-</div>
      </div>
      <div class="stat-box">
        <h3>Nível</h3>
        <div id="level">1</div>
      </div>
      <div class="stat-box">
        <h3>Cliques</h3>
        <div id="clicks">0</div>
      </div>
      <div class="stat-box">
        <h3>Meta</h3>
        <div id="target">10</div>
      </div>
      <div class="stat-box">
        <h3>Moedas</h3>
        <div id="coins">0</div>
      </div>
      <div class="stat-box">
        <h3>Poder de Clique</h3>
        <div id="click-power">1</div>
      </div>
    </div>
    
    <div class="progress-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    
    <div class="click-area" id="click-area">
      Clique aqui!
    </div>
    
    <div class="section">
      <h2>Contribuição dos Jogadores</h2>
      <div id="contribution-container">
        <!-- Será preenchido com as estatísticas de cada jogador -->
      </div>
    </div>
    
    <div class="game-sections">
      <div class="section">
        <h2>Upgrades</h2>
        <div id="upgrades-container">
          <!-- Upgrades serão adicionados aqui dinamicamente -->
        </div>
      </div>
      
      <div class="section">
        <h2>Objetivos</h2>
        <div id="achievements-container">
          <!-- Objetivos serão adicionados aqui dinamicamente -->
        </div>
      </div>
    </div>
    
    <div class="section">
      <h2>Log de Atividades</h2>
      <div id="chat-container" class="chat-container">
        <!-- Mensagens serão adicionadas aqui -->
      </div>
    </div>
  </div>
  
  <div class="notification" id="notification"></div>

  <script>
    // Estado do jogo
    let clicks = 0;
    let level = 1;
    let targetClicks = 10; // Requisito inicial
    let coins = 0;
    let clickPower = 1;
    let players = [];
    let activePlayerIndex = -1;
    let teamLevel = 1;
    let teamGoal = 5;
    let avatarColors = ['#007bff', '#6610f2', '#6f42c1', '#e83e8c', '#dc3545', '#fd7e14', '#ffc107', '#28a745'];
    
    // Elementos DOM
    const progressBar = document.getElementById('progress-bar');
    const clicksDisplay = document.getElementById('clicks');
    const levelDisplay = document.getElementById('level');
    const targetDisplay = document.getElementById('target');
    const coinsDisplay = document.getElementById('coins');
    const clickPowerDisplay = document.getElementById('click-power');
    const clickArea = document.getElementById('click-area');
    const gameContainer = document.querySelector('.game-container');
    const upgradesContainer = document.getElementById('upgrades-container');
    const achievementsContainer = document.getElementById('achievements-container');
    const notification = document.getElementById('notification');
    const playerList = document.getElementById('player-list');
    const playerNameInput = document.getElementById('player-name');
    const playerRoleSelect = document.getElementById('player-role');
    const addPlayerButton = document.getElementById('add-player');
    const switchPlayerButton = document.getElementById('switch-player');
    const activePlayerDisplay = document.getElementById('active-player');
    const contributionContainer = document.getElementById('contribution-container');
    const teamProgressBar = document.getElementById('team-progress-bar');
    const teamProgressDisplay = document.getElementById('team-progress');
    const teamGoalDisplay = document.getElementById('team-goal');
    const teamGoalDisplayExtra = document.getElementById('team-goal-display');
    const teamBonusMessage = document.getElementById('team-bonus-message');
    const chatContainer = document.getElementById('chat-container');
    
    // Definição de upgrades
    const upgrades = [
      {
        id: 'click-power',
        name: 'Poder de Clique',
        description: 'Aumenta o valor de cada clique',
        basePrice: 10,
        level: 0,
        maxLevel: 10,
        effect: level => level + 1,
        priceIncrease: 1.5
      },
      {
        id: 'auto-clicker',
        name: 'Auto Clicker',
        description: 'Clica automaticamente a cada segundo',
        basePrice: 50,
        level: 0,
        maxLevel: 5,
        effect: level => level,
        priceIncrease: 2
      },
      {
        id: 'coin-boost',
        name: 'Boost de Moedas',
        description: 'Aumenta as moedas ganhas por nível',
        basePrice: 30,
        level: 0,
        maxLevel: 5,
        effect: level => 1 + level * 0.2, // 20% de aumento por nível
        priceIncrease: 1.8
      },
      {
        id: 'progress-boost',
        name: 'Boost de Progresso',
        description: 'Reduz o aumento da dificuldade entre níveis',
        basePrice: 100,
        level: 0,
        maxLevel: 3,
        effect: level => 1.25 - (level * 0.05), // Reduz de 1.25 para 1.10
        priceIncrease: 2.5
      },
      {
        id: 'team-synergy',
        name: 'Sinergia de Equipe',
        description: 'Aumenta o poder de clique baseado no número de jogadores',
        basePrice: 40,
        level: 0,
        maxLevel: 5,
        effect: level => level * (players.length * 0.1), // 10% por jogador por nível
        priceIncrease: 1.7
      },
      {
        id: 'shared-rewards',
        name: 'Recompensas Compartilhadas',
        description: 'Jogadores inativos recebem uma porcentagem das moedas ganhas',
        basePrice: 75,
        level: 0,
        maxLevel: 3,
        effect: level => level * 0.15, // 15% por nível
        priceIncrease: 2.2
      }
    ];
    
    // Definição de objetivos
    const achievements = [
      {
        id: 'first-level',
        name: 'Primeiro Nível',
        description: 'Complete o nível 1',
        unlocked: false,
        requirement: () => level > 1,
        reward: 5
      },
      {
        id: 'level-5',
        name: 'Persistente',
        description: 'Alcance o nível 5',
        unlocked: false,
        requirement: () => level >= 5,
        reward: 20
      },
      {
        id: 'level-10',
        name: 'Dedicado',
        description: 'Alcance o nível 10',
        unlocked: false,
        requirement: () => level >= 10,
        reward: 50
      },
      {
        id: 'level-25',
        name: 'Mestre Clicker',
        description: 'Alcance o nível 25',
        unlocked: false,
        requirement: () => level >= 25,
        reward: 150
      },
      {
        id: 'coins-100',
        name: 'Colecionador',
        description: 'Acumule 100 moedas',
        unlocked: false,
        requirement: () => coins >= 100,
        reward: 10
      },
      {
        id: 'upgrade-max',
        name: 'Aprimorado',
        description: 'Maximize um upgrade',
        unlocked: false,
        requirement: () => upgrades.some(upgrade => upgrade.level >= upgrade.maxLevel),
        reward: 75
      },
      {
        id: 'team-goal',
        name: 'Esforço de Equipe',
        description: 'Atinja o primeiro objetivo da equipe',
        unlocked: false,
        requirement: () => teamLevel > 1,
        reward: 30
      },
      {
        id: 'team-players-3',
        name: 'Trabalho em Equipe',
        description: 'Tenha 3 ou mais jogadores na equipe',
        unlocked: false,
        requirement: () => players.length >= 3,
        reward: 25
      }
    ];
    
    // Inicializar jogo
    function initGame() {
      updateDisplays();
      renderUpgrades();
      renderAchievements();
      
      // Adicionar eventos de clique
      clickArea.addEventListener('click', handleClick);
      addPlayerButton.addEventListener('click', addPlayer);
      switchPlayerButton.addEventListener('click', switchPlayer);
      
      // Iniciar timer do auto-clicker
      setInterval(runAutoClicker, 1000);
      
      // Iniciar timer de verificação de objetivos
      setInterval(checkAchievements, 2000);
      
      // Adicionar mensagem inicial
      addChatMessage("Bem-vindo ao Clicker Cooperativo! Adicione jogadores para começar.", "system");
    }
    
    // Adicionar jogador
    function addPlayer() {
      const playerName = playerNameInput.value.trim();
      const playerRole = playerRoleSelect.value;
      
      if (playerName === "") {
        showNotification("Por favor, insira um nome para o jogador");
        return;
      }
      
      // Verificar se o jogador já existe
      if (players.some(p => p.name === playerName)) {
        showNotification("Este jogador já existe!");
        return;
      }
      
      // Criar objeto de jogador
      const roleBonus = {
        clicker: { type: "clickPower", value: 0.2 },
        upgrader: { type: "upgradeCost", value: -0.15 },
        supporter: { type: "teamBonus", value: 0.1 }
      };
      
      const colorIndex = players.length % avatarColors.length;
      
      const player = {
        name: playerName,
        role: playerRole,
        bonus: roleBonus[playerRole],
        level: 1,
        clicks: 0,
        coins: 0,
        contribution: 0,
        avatarColor: avatarColors[colorIndex],
        initials: playerName.slice(0, 2).toUpperCase()
      };
      
      players.push(player);
      renderPlayers();
      
      // Definir como jogador ativo se for o primeiro
      if (players.length === 1) {
        activePlayerIndex = 0;
        updateActivePlayer();
      }
      
      playerNameInput.value = "";
      
      // Adicionar mensagem ao chat
      addChatMessage(`${playerName} entrou no jogo como ${getRoleName(playerRole)}!`, "system");
      checkAchievements();
      
      // Atualizar contribuições
      renderContributions();
    }
    
    // Alternar entre jogadores
    function switchPlayer() {
      if (players.length === 0) {
        showNotification("Não há jogadores para alternar!");
        return;
      }
      
      activePlayerIndex = (activePlayerIndex + 1) % players.length;
      updateActivePlayer();
      
      // Adicionar mensagem ao chat
      addChatMessage(`Jogador ativo alterado para ${players[activePlayerIndex].name}`, "system");
    }
    
    // Atualizar jogador ativo
    function updateActivePlayer() {
      // Atualizar visualmente qual jogador está ativo
      const playerTags = document.querySelectorAll('.player-tag');
      playerTags.forEach((tag, index) => {
        tag.setAttribute('data-active', index === activePlayerIndex ? "true" : "false");
      });
      
      activePlayerDisplay.textContent = players[activePlayerIndex]?.name || "-";
      
      // Atualizar estatísticas para o jogador ativo
      if (activePlayerIndex >= 0) {
        const player = players[activePlayerIndex];
        level = player.level;
        clicks = player.clicks;
        coins = player.coins;
        
        // Recalcular clickPower com os bônus do jogador
        updateClickPower();
        
        updateDisplays();
        updateProgressBar();
        renderUpgrades();
      }
    }
    
    // Obter nome amigável do papel
    function getRoleName(role) {
      const roles = {
        clicker: "Clicker",
        upgrader: "Upgrader",
        supporter: "Supporter"
      };
      return roles[role] || role;
    }
    
    // Renderizar lista de jogadores
    function renderPlayers() {
      playerList.innerHTML = '';
      
      players.forEach((player, index) => {
        const playerTag = document.createElement('div');
        playerTag.className = 'player-tag';
        playerTag.setAttribute('data-active', index === activePlayerIndex ? "true" : "false");
        
        const roleClass = `role-${player.role}`;
        
        playerTag.innerHTML = `
          <div class="player-avatar" style="background-color: ${player.avatarColor}">${player.initials}</div>
          ${player.name}
          <span class="player-role ${roleClass}">${getRoleName(player.role)}</span>
        `;
        
        playerList.appendChild(playerTag);
      });
    }
    
    // Renderizar contribuições dos jogadores
    function renderContributions() {
      contributionContainer.innerHTML = '';
      
      if (players.length === 0) {
        contributionContainer.innerHTML = '<div>Adicione jogadores para ver as contribuições</div>';
        return;
      }
      
      // Calcular contribuição total
      const totalContribution = players.reduce((sum, player) => sum + player.contribution, 1); // Evitar divisão por zero
      
      players.forEach(player => {
        const percentage = (player.contribution / totalContribution * 100) || 0;
        
        const contributionElement = document.createElement('div');
        contributionElement.className = 'player-contribution';
        
        contributionElement.innerHTML = `
          <div>
            <div class="player-avatar" style="background-color: ${player.avatarColor}">${player.initials}</div>
            ${player.name} (Nv. ${player.level})
          </div>
          <div>${Math.floor(player.contribution)} cliques (${percentage.toFixed(1)}%)</div>
        `;
        
        const barContainer = document.createElement('div');
        barContainer.className = 'contribution-bar';
        
        const barFill = document.createElement('div');
        barFill.className = 'contribution-fill';
        barFill.style.width = `${percentage}%`;
        barFill.style.backgroundColor = player.avatarColor;
        
        barContainer.appendChild(barFill);
        contributionElement.appendChild(barContainer);
        
        contributionContainer.appendChild(contributionElement);
      });
    }
    
    // Adicionar mensagem ao chat
    function addChatMessage(text, type) {
      const messageElement = document.createElement('div');
      messageElement.className = `chat-message chat-${type}`;
      messageElement.textContent = text;
      
      chatContainer.appendChild(messageElement);
      
      // Auto-scroll para a mensagem mais recente
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    // Tratar clique
    function handleClick(event) {
      if (activePlayerIndex === -1) return;
      
      // Aplicar o clickPower atual com bônus
      const clickValue = calculateClickValue();
      clicks += clickValue;
      
      // Atualizar contribuição do jogador
      players[activePlayerIndex].clicks += clickValue;
      players[activePlayerIndex].contribution += clickValue;
      
      updateProgressBar();
      updateDisplays();
      
      // Verificar se a meta foi atingida
      if (clicks >= targetClicks) {
        levelUp();
      }
      
      // Ocasionalmente atualizar as contribuições (para não sobrecarregar o DOM)
      if (Math.random() < 0.1) {
        renderContributions();
      }
    }
    
    // Calcular valor do clique com todos os bônus
    function calculateClickValue() {
      let finalClickPower = clickPower;
      
      // Aplicar bônus de papel de "clicker" se aplicável
      if (players[activePlayerIndex]?.role === "clicker") {
        finalClickPower *= (1 + players[activePlayerIndex].bonus.value);
      }
      
      // Aplicar bônus de sinergia de equipe
      const teamSynergyBonus = getUpgradeEffect('team-synergy');
      if (teamSynergyBonus > 0) {
        finalClickPower *= (1 + teamSynergyBonus);
      }
      
      // Aplicar bônus de "supporter" (aumenta o poder de clique de todos)
      const supporterBonus = players.reduce((sum, p) => 
        p.role === "supporter" ? sum + p.bonus.value : sum, 0);
      if (supporterBonus > 0) {
        finalClickPower *= (1 + supporterBonus);
      }
      
      return Math.round(finalClickPower * 10) / 10; // Arredondar para 1 casa decimal
    }
    
    // Atualizar poder de clique base
    function updateClickPower() {
      clickPower = getUpgradeEffect('click-power');
      clickPowerDisplay.textContent = calculateClickValue().toFixed(1);
    }
    
    // Atualizar barra de progresso
    function updateProgressBar() {
      const progress = (clicks / targetClicks) * 100;
      progressBar.style.width = `${Math.min(100, progress)}%`;
      
      // Atualizar barra de progresso da equipe
      const teamProgress = (players.reduce((max, p) => Math.max(max, p.level), 0) / teamGoal) * 100;
      teamProgressBar.style.width = `${Math.min(100, teamProgress)}%`;
      teamProgressDisplay.textContent = players.reduce((max, p) => Math.max(max, p.level), 0);
    }
    
    // Atualizar elementos de exibição
    function updateDisplays() {
      clicksDisplay.textContent = Math.floor(clicks);
      levelDisplay.textContent = level;
      targetDisplay.textContent = Math.ceil(targetClicks);
      coinsDisplay.textContent = Math.floor(coins);
      
      // Atualizar exibições relacionadas à equipe
      teamGoalDisplay.textContent = teamGoal;
      teamGoalDisplayExtra.textContent = teamGoal;
      teamProgressDisplay.textContent = players.reduce((max, p) => Math.max(max, p.level), 0);
    }
    
    // Subir de nível
    function levelUp() {
      level++;
      
      // Atualizar o nível do jogador ativo
      if (activePlayerIndex >= 0) {
        players[activePlayerIndex].level = level;
      }
      
      // Aplicar efeito visual
      gameContainer.classList.add('level-up');
      setTimeout(() => {
        gameContainer.classList.remove('level-up');
      }, 1000);
      
      // Conceder moedas
      const coinBoost = getUpgradeEffect('coin-boost');
      const coinsAwarded = Math.round(level * 5 * coinBoost);
      coins += coinsAwarded;
      
      // Atualizar moedas do jogador ativo
      if (activePlayerIndex >= 0) {
        players[activePlayerIndex].coins = coins;
      }
      
      // Distribuir recompensas compartilhadas para jogadores inativos
      const sharedRewardBonus = getUpgradeEffect('shared-rewards');
      if (sharedRewardBonus > 0) {
        players.forEach((player, index) => {
          if (index !== activePlayerIndex) {
            const sharedCoins = Math.round(coinsAwarded * sharedRewardBonus);
            player.coins += sharedCoins;
            addChatMessage(`${player.name} recebeu ${sharedCoins} moedas compartilhadas!`, "system");
          }
        });
      }
      
      // Mostrar notificação
      showNotification(`${players[activePlayerIndex].name} alcançou o nível ${level}! +${coinsAwarded} moedas`);
      
      // Resetar cliques
      clicks = 0;
      
      // Aumentar meta com possível redução do boost de progresso
      const difficultyCurve = getUpgradeEffect('progress-boost');
      targetClicks = Math.ceil(targetClicks * difficultyCurve);
      
      // Verificar objetivo da equipe
      const highestLevel = players.reduce((max, p) => Math.max(max, p.level), 0);
      if (highestLevel >= teamGoal) {
        teamLevel++;
        teamGoal += 5; // Aumentar o objetivo da equipe
        teamBonusMessage.textContent = `Objetivo da equipe alcançado! Bônus: +${teamLevel * 10}% de moedas para todos!`;
        players.forEach(player => {
          player.coins += Math.round(player.coins * (teamLevel * 0.1));
        });
        addChatMessage(`Equipe atingiu o nível ${teamLevel}! Todos ganham +${teamLevel * 10}% de moedas!`, "system");
      }
      
      // Atualizar exibições
      updateProgressBar();
      updateDisplays();
      renderUpgrades();
      renderContributions();
      checkAchievements();
    }
    
    // Renderizar upgrades
    function renderUpgrades() {
      upgradesContainer.innerHTML = '';
      
      upgrades.forEach(upgrade => {
        let price = getUpgradePrice(upgrade);
        
        // Aplicar desconto de "upgrader" se houver jogadores com esse papel
        const upgraderDiscount = players.some(p => p.role === "upgrader") && upgrade.level < upgrade.maxLevel
          ? players.filter(p => p.role === "upgrader").reduce((sum, p) => sum + p.bonus.value, 0)
          : 0;
        price = Math.round(price * (1 + upgraderDiscount));
        
        const canAfford = coins >= price;
        const maxedOut = upgrade.level >= upgrade.maxLevel;
        
        const upgradeElement = document.createElement('div');
        upgradeElement.className = `upgrade-item ${(!canAfford || maxedOut) ? 'disabled' : ''}`;
        
        upgradeElement.innerHTML = `
          <div class="upgrade-info">
            <div><strong>${upgrade.name}</strong> <span class="upgrade-level">(Nível ${upgrade.level}/${upgrade.maxLevel})</span></div>
            <div>${upgrade.description}</div>
          </div>
          <button class="buy-button" ${(!canAfford || maxedOut) ? 'disabled' : ''}>${maxedOut ? 'MAX' : price + ' 🪙'}</button>
        `;
        
        // Adicionar evento de clique apenas se não estiver no máximo e puder pagar
        if (!maxedOut && canAfford) {
          upgradeElement.querySelector('.buy-button').addEventListener('click', (e) => {
            e.stopPropagation(); // Impedir que o clique global seja acionado
            buyUpgrade(upgrade.id);
          });
        }
        
        upgradesContainer.appendChild(upgradeElement);
      });
    }
    
    // Renderizar objetivos
    function renderAchievements() {
      achievementsContainer.innerHTML = '';
      
      achievements.forEach(achievement => {
        const achievementElement = document.createElement('div');
        achievementElement.className = `achievement-item ${achievement.unlocked ? 'unlocked' : 'locked'}`;
        
        achievementElement.innerHTML = `
          <div class="achievement-info">
            <div><strong>${achievement.name}</strong></div>
            <div>${achievement.description}</div>
            <div>${achievement.unlocked ? 'Concluído ✓' : `Recompensa: ${achievement.reward} 🪙`}</div>
          </div>
        `;
        
        achievementsContainer.appendChild(achievementElement);
      });
    }
    
    // Comprar upgrade
    function buyUpgrade(upgradeId) {
      const upgrade = upgrades.find(u => u.id === upgradeId);
      if (!upgrade) return;
      
      let price = getUpgradePrice(upgrade);
      
      // Aplicar desconto de "upgrader"
      const upgraderDiscount = players.some(p => p.role === "upgrader") && upgrade.level < upgrade.maxLevel
        ? players.filter(p => p.role === "upgrader").reduce((sum, p) => sum + p.bonus.value, 0)
        : 0;
      price = Math.round(price * (1 + upgraderDiscount));
      
      if (coins >= price && upgrade.level < upgrade.maxLevel) {
        coins -= price;
        upgrade.level++;
        
        // Atualizar moedas do jogador ativo
        if (activePlayerIndex >= 0) {
          players[activePlayerIndex].coins = coins;
        }
        
        // Aplicar efeitos dos upgrades
        if (upgradeId === 'click-power') {
          updateClickPower();
        }
        
        // Mostrar notificação
        showNotification(`Upgrade de ${upgrade.name} comprado por ${players[activePlayerIndex].name}!`);
        addChatMessage(`${players[activePlayerIndex].name} comprou ${upgrade.name} nível ${upgrade.level}`, "player");
        
        // Atualizar exibições
        updateDisplays();
        renderUpgrades();
        
        // Verificar conquistas após a compra
        if (upgrade.level >= upgrade.maxLevel) {
          checkAchievements();
        }
      }
    }
    
    // Obter preço do upgrade baseado no nível
    function getUpgradePrice(upgrade) {
      return Math.ceil(upgrade.basePrice * Math.pow(upgrade.priceIncrease, upgrade.level));
    }
    
    // Obter efeito do upgrade baseado no nível
    function getUpgradeEffect(upgradeId) {
      const upgrade = upgrades.find(u => u.id === upgradeId);
      if (!upgrade) return 0; // Retornar 0 se não encontrado
      
      return upgrade.effect(upgrade.level);
    }
    
    // Executar auto-clicker
    function runAutoClicker() {
      if (activePlayerIndex === -1) return;
      
      const autoClickPower = getUpgradeEffect('auto-clicker');
      if (autoClickPower > 0) {
        const clickValue = calculateClickValue() * autoClickPower;
        clicks += clickValue;
        players[activePlayerIndex].clicks += clickValue;
        players[activePlayerIndex].contribution += clickValue;
        
        updateProgressBar();
        updateDisplays();
        
        // Verificar se a meta foi atingida
        if (clicks >= targetClicks) {
          levelUp();
        }
      }
    }
    
    // Verificar conquistas
    function checkAchievements() {
      let newUnlocks = false;
      
      achievements.forEach(achievement => {
        if (!achievement.unlocked && achievement.requirement()) {
          achievement.unlocked = true;
          coins += achievement.reward;
          if (activePlayerIndex >= 0) {
            players[activePlayerIndex].coins = coins;
          }
          showNotification(`Objetivo alcançado: ${achievement.name}! +${achievement.reward} 🪙`);
          addChatMessage(`Equipe desbloqueou "${achievement.name}"! +${achievement.reward} moedas`, "system");
          newUnlocks = true;
        }
      });
      
      if (newUnlocks) {
        renderAchievements();
        renderUpgrades(); // Re-renderizar caso novas moedas permitam compras
        updateDisplays();
      }
    }
    
    // Mostrar notificação
    function showNotification(message) {
      notification.textContent = message;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
    
    // Inicializar o jogo
    initGame();
  </script>
</body>
</html>
